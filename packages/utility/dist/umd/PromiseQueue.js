!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("PromiseQueue",[],t):"object"==typeof exports?exports.PromiseQueue=t():e.PromiseQueue=t()}(this,(()=>(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,i(n.key),n)}}function i(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==r(t)?t:t+""}e.r(t),e.d(t,{PromisePool:()=>b,PromiseQueue:()=>g,doPoll:()=>P,promisePool:()=>b,promiseQueue:()=>g});var u=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.listeners={}},t=[{key:"on",value:function(e,t){this.registerListener(e,t)}},{key:"once",value:function(e,t){this.registerListener(e,t,1)}},{key:"exactly",value:function(e,t,r){this.registerListener(e,t,r)}},{key:"off",value:function(e){delete this.listeners[e]}},{key:"detach",value:function(e,t){var r=(this.listeners[e]||[]).filter((function(e){return e.callback!==t}));return e in this.listeners&&(this.listeners[e]=r,!0)}},{key:"emit",value:function(e){for(var t=this,r=arguments.length,o=new Array(r>1?r-1:0),i=1;i<r;i++)o[i-1]=arguments[i];var u=[],a=null,s=this.extractContextFromArgs(o),c=s[0];if(o=s[1],this.hasListener(e))u=this.listeners[e];else if(e.includes("*"))(a=this.patternSearch(e,Object.keys(this.listeners)))&&a.forEach((function(e){u=u.concat(t.listeners[e])}));else for(var l in this.listeners)(a=this.patternSearch(l,[e]))&&(u=u.concat(this.listeners[l]));u.forEach((function(r,i){var a,s=r.callback;c&&(s=s.bind(c)),s.apply(void 0,function(e){if(Array.isArray(e))return n(e)}(a=o)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(a)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(a)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),void 0!==r.triggerCapacity&&(r.triggerCapacity--,u[i].triggerCapacity=r.triggerCapacity),t.checkToRemoveListener(r)&&t.listeners[e].splice(i,1)}))}},{key:"patternSearch",value:function(e,t){var r,n=new RegExp(this.setWildCardString(e));return 0===(r=t.filter((function(e){return n.test(e)}))).length?null:r}},{key:"setWildCardString",value:function(e){var t=e.replace(/([.+?^${}()|\[\]\/\\])/g,"\\$&");return t=t.replace(/\*\*/g,"[_g_]").replace(/\*/g,"(.*?)").replace(/\[_g_\]/g,".*"),"^".concat(t,"$")}},{key:"extractContextFromArgs",value:function(e){for(var t=null,n=0;n<e.length;n++){var o=e[n];if(o&&"object"===r(o)&&o.hasOwnProperty("__context")){t=o.__context,e.splice(n,1);break}}return[t,e]}},{key:"registerListener",value:function(e,t,r){this.hasListener(e)||(this.listeners[e]=[]),this.listeners[e].push({callback:t,triggerCapacity:r})}},{key:"checkToRemoveListener",value:function(e){return void 0!==e.triggerCapacity&&e.triggerCapacity<=0}},{key:"hasListener",value:function(e){return e in this.listeners}}],t&&o(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}(),a=function(e){return Array.isArray(e)?e:[e]};function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,y(n.key),n)}}function f(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function y(e){var t=function(e,t){if("object"!=s(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==s(t)?t:t+""}function p(e,t,r){return t=m(t),function(e,t){if(t&&("object"===s(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,h()?Reflect.construct(t,r||[],m(e).constructor):t.apply(e,r))}function h(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(h=function(){return!!e})()}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d(e,t)}function d(e,t){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},d(e,t)}var b=function(){var e="in-progress",t={},r=[];return new(function(n){function o(){return c(this,o),p(this,o)}return v(o,n),f(o,[{key:"add",value:function(e){if(e instanceof Promise==1&&Array.isArray(e)&&e.every((function(e){return e instanceof Promise})))throw new Error("promisePool: The first argument must be a promise or an array of promises.");var r=this;a(e).forEach((function(e){var n=Promise.all([e]),o="kn__"+(new Date).getTime()+"__"+Math.floor(899*Math.random());t[o]={promiseBag:n,status:"in-progress"},n.then((function(){t[o].status="completed",r._updateStatus()})).catch((function(){t[o].status="rejected",r._updateStatus()}))}))}},{key:"status",value:function(){return e}},{key:"isDone",value:function(){return"done"===e}},{key:"_updateStatus",value:function(){if("done"!==e){var n=Object.values(t);n.forEach((function(e){"rejected"===e.status&&r.push(e)}));var o=n.every((function(e){return"completed"===e.status||"rejected"===e.status}));e=o?"done":"in-progress",this.emit("stats",{completed:n.filter((function(e){return"completed"===e.status})).length,rejected:r.length,pending:n.filter((function(e){return"in-progress"===e.status})).length,total:n.length}),"done"===e&&(this.emit("completed"),this.emit("rejected",r),this.clear())}}},{key:"clear",value:function(){t={},r=[]}}])}(u))},g=function(e){function t(){var e;return c(this,t),(e=p(this,t)).queue=[],e.inProgress=!1,e._timer=null,e}return v(t,e),f(t,[{key:"add",value:function(e){var t=this;a(e).forEach((function(e){t.queue.push({promiseFunction:e,status:"pending"})})),this.inProgress||this._next(),this._setTimer()}},{key:"clear",value:function(){this.queue=[]}},{key:"_setTimer",value:function(){var e=this;this._timer&&clearInterval(this._timer),this._timer=setInterval((function(){"done"===e.status()&&(e.emit("completed"),clearInterval(e._timer),e._timer=null)}),10)}},{key:"_next",value:function(){var e=this;0!==this.queue.length?(this.inProgress=!0,(0,this.queue[0].promiseFunction)().then((function(){e.queue[0].status="fulfilled"})).catch((function(){e.queue[0].status="rejected"})).finally((function(){e.queue.shift(),e._next()}))):this.inProgress=!1}},{key:"status",value:function(){return 0===this.queue.length?"done":"in-progress"}}])}(u),P=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("function"!=typeof e)throw new Error("doPoll: The first argument must be a function.");var r,n,o,i,u=t.interval,a=void 0===u?200:u,s=t.timeout,c=void 0===s?1e3:s,l=t.timeoutMsg,f=void 0===l?"===> doPoll: cancelled or timed out.":l,y=!1,p=function(){m(),i(console.info(f))},h=function(e){m(),o(e)};function m(){y=!0,clearTimeout(r),clearInterval(n)}return{promise:new Promise((function(t,u){o=t,i=u;var s=e instanceof Promise,l=function(){if(!y){var t=s?e:e();s?t.then((function(e){e&&h(e)})).catch(i):(Boolean(t)||t)&&h(t)}};n=setInterval(l,a),l(),r=setTimeout((function(){y||p()}),c)})),stop:p}};return t})()));